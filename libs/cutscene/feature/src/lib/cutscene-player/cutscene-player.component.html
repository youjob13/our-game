<div class="cutscene-container">
  <!-- Background -->
  @if (facade.currentBackground(); as background) {
    <sml-lib-background-renderer [background]="background" />
    <div class="background-overlay"></div>
  }

  <!-- Characters -->
  <div class="characters-layer">
    @if (leftCharacter(); as leftChar) {
      <div class="character-left">
        <sml-lib-character-sprite
          [character]="leftChar"
          [isSpeaking]="isSpeaking(leftChar.id)"
          [speakerEmotion]="currentSpeakerEmotion()"
        />
      </div>
    }

    @if (rightCharacter(); as rightChar) {
      <div class="character-right">
        <sml-lib-character-sprite
          [character]="rightChar"
          [isSpeaking]="isSpeaking(rightChar.id)"
          [speakerEmotion]="currentSpeakerEmotion()"
        />
      </div>
    }
  </div>

  <!-- Dialog UI -->
  <div class="dialog-layer">
    <!-- Progress indicator -->
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="facade.progress()"></div>
    </div>

    <!-- Dialog box -->
    <div class="dialog-container">
      <sml-lib-dialog-box [dialog]="facade.currentDialog()" />
    </div>

    <!-- Skip button -->
    <button class="skip-button" (click)="handleSkip()">Пропустить (ESC)</button>
  </div>

  <!-- Completion screen -->
  @if (facade.isCompleted()) {
    <div class="completion-overlay">
      <div class="completion-content">
        <h2>Глава завершена</h2>
        <p>{{ facade.currentChapter()?.title }}</p>
        <button class="continue-button" (click)="cutsceneComplete.emit()">Продолжить</button>
      </div>
    </div>
  }
</div>
